<html>
<title>A Dashboard using DynamoDB PoC for W205</title>
<head>
    <script src="https://sdk.amazonaws.com/js/aws-sdk-2.2.19.min.js"></script>
</head>
<body>
    <script type="application/javascript">
        AWS.config.update({accessKeyId: 'AKIAJCHOVEWJZZ4L4PJQ', secretAccessKey: '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'});
        AWS.config.region = 'us-east-1';
        var dynamodb = new AWS.DynamoDB();
        var docClient = new AWS.DynamoDB.DocumentClient(dynamodb);
        dynamodb.listTables(function(err, data) {
            console.log(data.TableNames);
        });

        var table = new AWS.DynamoDB({apiVersion: '2012-08-10', params: {TableName: 'twitter_users_processed'}});
        var valueToPut = JSON.stringify({
            "user_account_created": "Sat Oct 15 10:10:40 MST 2015",
            "followers": 10,
            "following": 30,
            "tweet_id": "9482048934839048394894948",
            "tweet_content": "Free iPad - this is a true and genuine offer: http://bit.ly/4905404"
        })

        // Write the item to the table
        var itemParams = {
                Item:
                {
                    "user_name": {S:"spammer"},
                    "date_YYYYMMDD": {S:"20151128"},
                    "data": {S:valueToPut}
                }
        };
        table.putItem(itemParams, function(err, data) {
            // Read the item from the table
            if (err) console.log(err, err.stack); // an error occurred
            else     console.log(data);
        });

        var valueToPut = JSON.stringify({
            "user_account_created": "Sat Oct 15 10:10:40 MST 2015",
            "followers": 10,
            "following": 40,
            "tweet_id": "94820489348390483948949990",
            "tweet_content": "Free Samsung Notebook - this is a true and genuine offer: http://bit.ly/4905404"
        })

        // Write the item to the table
        var itemParams = {
            Item:
            {
                "user_name": {S:"spammer"},
                "date_YYYYMMDD": {S:"20151129"},
                "data": {S:valueToPut}
            }
        };
        table.putItem(itemParams, function(err, data) {
            // Read the item from the table
            if (err) console.log(err, err.stack); // an error occurred
            else     console.log(data);
        });

        /*************** NEW AWS DOC CLIENT SDK MAKES IT BETTER! ****************/
        //Starting here - using docClient

        params = {};
        params.TableName = "twitter_users_processed";
        params.Key = {user_name : "spammer", date_YYYYMMDD:"20151128"}
        docClient.get(params, function(err, data) {
            if (err) console.log(err, err.stack); // an error occurred
            else console.log(data.Item); // print the item data
        });

        //Lets try put
        var params = {
                TableName: 'twitter_users_processed',
                Item: {
                    user_name: 'sharmila',
                    date_YYYYMMDD: '20151129',
                    data: {
                            acct_created: "Sat Sep 15 09:00:40 MST 2015",
                            followers: 10,
                            following: 40,
                            tweet_id: "4357483758494555565",
                            tweet_content: "Get yourself a smart loan: http://bit.ly/ertret/44"
                    }
                }
        };

        docClient.put(params, function(err, data) {
            if (err) console.log(err, err.stack); // an error occurred
           else  console.log(data); // print the item data
        });


    </script>
</body>
</html>